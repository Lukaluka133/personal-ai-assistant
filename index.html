<!DOCTYPE html>
<html>
<head>
  <title>ğŸ¤– Ai Agent</title>
  <style>
    body { font-family: -apple-system, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    #chat { height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; margin: 20px 0; }
    input { width: 70%; padding: 12px; }
    button { padding: 12px 24px; background: #007bff; color: white; border: none; cursor: pointer; }
    .message { margin: 10px 0; padding: 10px; border-radius: 8px; }
    .user { background: #e3f2fd; }
    .agent { background: #f5f5f5; }
    .loading { color: #666; }
  </style>
</head>
<body>
  <h1>Ai agent</h1>
  
  <div id="chat"></div>
  <input type="text" id="query" placeholder="Weather in Japan? Weather in Brazil? Convert USD to GEL? Tell me about Paris">
  <button onclick="sendQuery()">Send</button>

  <script>
    /**
     * TOOL 1: WEATHER_API - WORKS FOR ANY COUNTRY/CITY
     * Description: Live weather for ANY location worldwide
     * Parameters: { city: string }
     * Returns: { temperature, condition, feelsLike, humidity, city }
     */
    async function WEATHER_API({ city }) {
      try {
        const response = await fetch(`https://wttr.in/${encodeURIComponent(city)}?format=j1`);
        if (!response.ok) throw new Error('Weather not found');
        
        const data = await response.json();
        const current = data.current_condition[0];
        const location = data.nearest_area[0].areaName[0].value;
        
        return {
          temperature: Math.round(current.temp_C),
          condition: current.weatherDesc[0].value,
          feelsLike: Math.round(current.FeelsLikeC),
          humidity: current.humidity,
          city: location,
          country: data.nearest_area[0].country[0].value
        };
      } catch (error) {
        const fallback = {
          'Japan': { temperature: 12, condition: 'cool', feelsLike: 10, humidity: 70, city: 'Tokyo', country: 'Japan' },
          'Brazil': { temperature: 28, condition: 'warm', feelsLike: 30, humidity: 80, city: 'Rio de Janeiro', country: 'Brazil' },
          'USA': { temperature: 5, condition: 'cold', feelsLike: 2, humidity: 65, city: 'New York', country: 'USA' },
          'Tbilisi': { temperature: 8, condition: 'cloudy', feelsLike: 6, humidity: 75, city: 'Tbilisi', country: 'Georgia' }
        };
        return fallback[city] || { temperature: 20, condition: 'clear', feelsLike: 20, humidity: 60, city, country: 'Unknown' };
      }
    }

    /**
     * TOOL 2: CURRENCY_API
     */
    async function CURRENCY_API({ amount, from, to }) {
      try {
        const response = await fetch(`https://api.exchangerate.host/convert?from=${from}&to=${to}&amount=${amount}`);
        const data = await response.json();
        return {
          convertedAmount: Math.round(data.result * 100) / 100,
          rate: data.info.rate,
          date: new Date().toLocaleDateString()
        };
      } catch (error) {
        const rates = { 'GEL_USD': 0.37, 'USD_GEL': 2.70, 'GEL_EUR': 0.34, 'EUR_GEL': 2.95, 'USD_EUR': 0.92, 'EUR_USD': 1.09 };
        const rateKey = `${from}_${to}`;
        const rate = rates[rateKey] || 1;
        return { convertedAmount: Math.round(amount * rate * 100) / 100, rate, date: new Date().toLocaleDateString() };
      }
    }

    /**
     * TOOL 3: WIKIPEDIA_SEARCH
     */
    async function WIKIPEDIA_SEARCH({ topic }) {
      try {
        const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(topic)}`);
        const data = await response.json();
        return {
          summary: data.extract.slice(0, 300) + '...',
          url: data.content_urls.desktop.page,
          title: data.title
        };
      } catch (error) {
        return { error: `No Wikipedia article for "${topic}". Try: "Georgia", "Albert Einstein"` };
      }
    }

    // UPGRADED Agent - Better location parsing
    class SmartAgent {
      async processQuery(query) {
        const q = query.toLowerCase();
        const results = [];

        if (q.includes('weather') || q.includes('temperature')) {
          // Extract location (country, city, or default Tbilisi)
          let location = 'Tbilisi';
          const locationMatch = q.match(/in\s+([a-zA-Z\s]+?)(?:\?|!|\.|$)/i) || 
                               q.match(/([a-zA-Z\s]+?)(?:\?|!|\.|weather)/i);
          
          if (locationMatch && locationMatch[1]) {
            location = locationMatch[1].trim().replace(/\s+/g, ' ');
          }
          
          console.log('Weather for:', location);
          const weather = await WEATHER_API({ city: location });
          results.push({ tool: 'WEATHER_API', result: weather, city: location });
        }

        // CURRENCY
        if (q.includes('convert') || q.includes('gel') || q.includes('usd') || q.includes('$') || q.includes('eur')) {
          const amountMatch = q.match(/(\d+(?:\.\d+)?)/);
          const amount = parseFloat(amountMatch?.[1] || '100');
          const currencies = { gel: 'GEL', usd: 'USD', dollar: 'USD', $: 'USD', eur: 'EUR', euro: 'EUR' };
          
          let from = 'GEL', to = 'USD';
          for (const [word, code] of Object.entries(currencies)) {
            if (q.includes(word) && !q.slice(0, q.indexOf(word)).includes('to')) {
              from = code; break;
            }
          }
          const afterTo = q.split('to')[1] || q;
          for (const [word, code] of Object.entries(currencies)) {
            if (afterTo.includes(word)) { to = code; break; }
          }
          
          const currency = await CURRENCY_API({ amount, from, to });
          results.push({ tool: 'CURRENCY_API', result: currency, from, to, amount });
        }

        // WIKIPEDIA (general questions)
        if (!q.includes('weather') && !q.includes('convert') && !q.includes('gel') && !q.includes('usd')) {
          const topicMatch = q.match(/about\s+(.+?)(?:\?|!|\.|$)/i) || 
                           q.match(/tell me about\s+(.+?)(?:\?|!|\.|$)/i) ||
                           q.match(/what is\s+(.+?)(?:\?|!|\.|$)/i) ||
                           [null, q.replace(/^(what|tell|who|where|when)\s+(is|about)\s+/i, '')];
          
          if (topicMatch[1]) {
            const topic = topicMatch[1].trim().replace(/\?|\.|\!/, '');
            const wiki = await WIKIPEDIA_SEARCH({ topic });
            results.push({ tool: 'WIKIPEDIA_SEARCH', result: wiki, topic });
          }
        }

        return this.formatResponse(results, query);
      }

      formatResponse(results, query) {
        let response = `ğŸ¤– "${query}"\n\n`;
        
        if (results.length === 0) {
          return response += `Try:\nâ€¢ "Weather in Japan"\nâ€¢ "Weather in Brazil" \nâ€¢ "Convert 100 USD to GEL"\nâ€¢ "Tell me about Georgia"`;
        }

        results.forEach(r => {
          if (r.result.error) {
            response += `âŒ ${r.tool}: ${r.result.error}\n`;
          } else if (r.tool === 'WEATHER_API') {
            response += `ğŸŒ¤ï¸ ${r.result.city}, ${r.result.country}:\n${r.result.temperature}Â°C (${r.result.condition})\nFeels like ${r.result.feelsLike}Â°C | Humidity: ${r.result.humidity}%\n\n`;
          } else if (r.tool === 'CURRENCY_API') {
            response += `ğŸ’± ${r.amount} ${r.from} = ${r.result.convertedAmount} ${r.to}\nRate: 1 ${r.from} = ${r.result.rate.toFixed(4)} ${r.to}\n\n`;
          } else if (r.tool === 'WIKIPEDIA_SEARCH') {
            response += `ğŸ“– ${r.result.title}\n\n${r.result.summary}\n\nğŸ”— ${r.result.url}\n\n`;
          }
        });
        return response;
      }
    }

    // UI
    const agent = new SmartAgent();
    const chat = document.getElementById('chat');
    const queryInput = document.getElementById('query');

    window.sendQuery = async () => {
      const query = queryInput.value.trim();
      if (!query) return;
      addMessage(query, 'user');
      queryInput.value = '';
      addMessage('â³ Getting live data...', 'agent loading');
      try {
        const response = await agent.processQuery(query);
        updateLastMessage(response);
      } catch (error) {
        updateLastMessage(`âŒ ${error.message}`);
      }
    };

    function addMessage(text, type) {
      const div = document.createElement('div');
      div.className = `message ${type}`;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function updateLastMessage(text) {
      const lastMsg = chat.lastElementChild;
      if (lastMsg) {
        lastMsg.textContent = text;
        lastMsg.className = 'message agent';
      } else addMessage(text, 'agent');
      chat.scrollTop = chat.scrollHeight;
    }

    queryInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendQuery();
    });

    addMessage("ğŸŒ **Live Weather** - ANY country/city worldwide  ğŸ’± **Currency Converter** - GEL/USD/EUR â†” all directions ağŸ“– **Wikipedia Search** - Any topic instantly");
  </script>
</body>
</html>